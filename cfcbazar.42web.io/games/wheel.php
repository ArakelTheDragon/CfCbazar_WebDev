<?phpsession_start();if (!isset($_SESSION['email'])) {    header('Location: /login.php');    exit();}$email = $_SESSION['email'];?><!DOCTYPE html><html lang="en"><head>  <meta charset="UTF-8">  <title>Wheel of Fortune - WorkTokens</title>  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  <style>    body {      font-family: Arial, sans-serif;      background-color: #f2f2f2;      margin: 0;      padding: 20px;      text-align: center;    }    /* Updated container dimensions for mobile-friendly display */    #wheelContainer {      position: relative;      margin: 20px auto;      width: 300px;      height: 300px;    }    canvas {      border: 5px solid #333;      border-radius: 50%;      background: #fff;      width: 100%;      height: 100%;    }    #pin {      width: 20px;      height: 40px;      background-color: red;      position: absolute;      left: 50%;      top: 10px;      transform: translateX(-50%);      border-radius: 5px;      z-index: 2;    }    /* The spin button is now placed right below the wheel */    #spinButton {      padding: 10px 20px;      font-size: 1.1rem;      background-color: #3498db;      color: #fff;      border: none;      border-radius: 5px;      cursor: pointer;      transition: background-color 0.3s ease;      margin-top: 10px;    }    #spinButton:hover {      background-color: #2980b9;    }  </style></head><body>  <h1>ðŸŽ¡ Wheel of Fortune - WorkTokens</h1>  <h2 id="balanceDisplay">Loading balance...</h2>  <h3>Spin Cost: 0.05 WorkTokens</h3>  <div id="wheelContainer">    <div id="pin"></div>    <canvas id="wheelCanvas" width="300" height="300"></canvas>  </div>    <!-- Spin button placed directly under the wheel container -->  <button id="spinButton">Spin the Wheel!</button>  <script>    const email = <?= json_encode($email) ?>;    let totalBalance = 0;    const spinCost = 0.05;    const canvas = document.getElementById('wheelCanvas');    const ctx = canvas.getContext('2d');    const prizes = [      { text: "+0.01 WT", value: 0.01, color: "#f39c12", weight: 40 },      { text: "+0.025 WT", value: 0.025, color: "#e74c3c", weight: 30 },      { text: "+0.05 WT", value: 0.05, color: "#2ecc71", weight: 15 },      { text: "+0.10 WT", value: 0.10, color: "#9b59b6", weight: 10 },      { text: "-0.050 WT", value: -0.050, color: "#3498db", weight: 50 },      { text: "-0.150 WT", value: -0.150, color: "#1abc9c", weight: 30 },      { text: "-0.300 WT", value: -0.300, color: "#e67e22", weight: 20 },      { text: "Jackpot! +5 WT", value: 5, color: "#34495e", weight: 1 }    ];    const arcSize = (2 * Math.PI) / prizes.length;    let rotationAngle = -Math.PI / 2 - arcSize / 2;    let spinStartTime = null;    let spinDuration = 3000; // animation duration in milliseconds    let startRotation = 0;    let targetRotation = 0;    let spinning = false;    let targetPrizeIndex = 0;    function drawWheel() {      ctx.clearRect(0, 0, canvas.width, canvas.height);      const centerX = canvas.width / 2;      const centerY = canvas.height / 2;      const radius = canvas.width / 2 - 10; // leave padding for stroke      for (let i = 0; i < prizes.length; i++) {        const startAngle = rotationAngle + i * arcSize;        const endAngle = startAngle + arcSize;        ctx.beginPath();        ctx.moveTo(centerX, centerY);        ctx.arc(centerX, centerY, radius, startAngle, endAngle, false);        ctx.closePath();        ctx.fillStyle = prizes[i].color;        ctx.fill();        ctx.strokeStyle = "#fff";        ctx.lineWidth = 2;        ctx.stroke();        ctx.save();        ctx.translate(centerX, centerY);        ctx.rotate(startAngle + arcSize / 2);        ctx.textAlign = "right";        ctx.fillStyle = "#fff";        ctx.font = "bold 12px Arial";        ctx.fillText(prizes[i].text, radius - 10, 10);        ctx.restore();      }    }    function easeOutCubic(t) {      return (--t) * t * t + 1;    }    function updateBalanceDisplay() {      document.getElementById("balanceDisplay").textContent =        "Total Balance: " + totalBalance.toFixed(5) + " WorkTokens";    }    async function fetchBalance() {      const res = await fetch("/worker.php?email=" + encodeURIComponent(email));      const data = await res.json();      totalBalance = parseFloat(data.tokens_earned);      updateBalanceDisplay();    }    function getWeightedPrizeIndex() {      const totalWeight = prizes.reduce((sum, p) => sum + p.weight, 0);      let rand = Math.random() * totalWeight;      for (let i = 0; i < prizes.length; i++) {        if (rand < prizes[i].weight) return i;        rand -= prizes[i].weight;      }      return 0;    }    function animateSpin(timestamp) {      if (!spinStartTime) spinStartTime = timestamp;      const elapsed = timestamp - spinStartTime;      const t = Math.min(elapsed / spinDuration, 1);      const eased = easeOutCubic(t);      rotationAngle = startRotation + (targetRotation - startRotation) * eased;      drawWheel();      if (t < 1) {        requestAnimationFrame(animateSpin);      } else {        spinning = false;        const prize = prizes[targetPrizeIndex];        totalBalance += prize.value;        updateBalanceDisplay();        // Sync prize result to the backend        fetch("/worker.php", {          method: "POST",          headers: { "Content-Type": "application/x-www-form-urlencoded" },          body: "email=" + encodeURIComponent(email) + "&tokens=" + prize.value        });        alert(`You won ${prize.text}!`);      }    }    document.getElementById("spinButton").addEventListener("click", () => {      if (spinning) return;      if (totalBalance < spinCost) {        alert("Not enough WorkTokens to spin!");        return;      }      spinning = true;      totalBalance -= spinCost;      updateBalanceDisplay();      // Deduct the spin cost in backend as well      fetch("/worker.php", {        method: "POST",        headers: { "Content-Type": "application/x-www-form-urlencoded" },        body: "email=" + encodeURIComponent(email) + "&tokens=-0.05"      });      targetPrizeIndex = getWeightedPrizeIndex();      const pointer = -Math.PI / 2;      const baseAngle = pointer - (targetPrizeIndex + 0.5) * arcSize;      startRotation = rotationAngle;      let ns = ((startRotation % (2 * Math.PI)) + 2 * Math.PI) % (2 * Math.PI);      let nb = ((baseAngle % (2 * Math.PI)) + 2 * Math.PI) % (2 * Math.PI);      let extra = nb - ns;      if (extra <= 0) extra += 2 * Math.PI;  